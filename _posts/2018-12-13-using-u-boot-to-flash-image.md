---
layout: post
title: "使用U-boot中的tftp來燒錄flash"
author:     Kevin Lee
tags: 		U-boot Tftp
subtitle:   
category:  project1
visualworkflow: true
---
本燒錄方式需要u-boot已經在flash上，才能透過此方式去燒錄

如果是空的flash，無法透過此方式來燒錄。

在接線方式因為是走tftp，所以網路線和Router都要與PC接好，PC端是要安裝Tftp Server

### 設置u-boot環境變數

$ setenv serverip 192.168.2.102

$ setenv ethaddr 00:11:22:33:44:55

$ setenv eth1addr 00:aa:bb:cc:dd:ee

$ dhcp

```
ast# dhcp
FTGMAC100#1: Starting autonegotiation...
FTGMAC100#1: Autonegotiation complete
FTGMAC100#1: link up, 100Mbps full-duplex
BOOTP broadcast 1
BOOTP broadcast 2
BOOTP broadcast 3
DHCP client bound to address 192.168.2.105 (1034 ms)
*** Warning: no boot file name; using 'C0A80269.img'
Using FTGMAC100#1 device
TFTP from server 192.168.2.102; our IP address is 192.168.2.105
Filename 'C0A80269.img'.
Load address: 0x83000000
Loading: *
TFTP error: 'File not found' (1)
Not retrying...

```

### 開始燒錄

$ tftp 0x83000000 image-bmc

```
ast# tftp 0x83000000 image-bmc
FTGMAC100#1: link up, 100Mbps full-duplex
Using FTGMAC100#1 device
TFTP from server 192.168.2.102; our IP address is 192.168.2.105
Filename 'image-bmc'.
Load address: 0x83000000
Loading: #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         ###########
         2 MiB/s
done
Bytes transferred = 33554432 (2000000 hex)
```

$ protect off all 

```
ast# protect off all
Un-Protect Flash Bank # 1
```

$ erase all  

```
ast# erase all
Erase Flash Bank # 1 
.....................
```

$ cp.b 0x83000000 0x20000000 2000000 

$ saveenv 

$ reset 